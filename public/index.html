<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>prometheus obfuscator</title>
<style>
:root{--bg:#071022;--panel:#0b1220;--accent:#f6c85f}
body{margin:0;font-family:Inter,system-ui;background:linear-gradient(#071022,#08132a);color:#e6eef6}
.container{max-width:900px;margin:28px auto;padding:18px;background:rgba(255,255,255,0.02);border-radius:10px}
textarea{width:100%;height:220px;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.05);background:#061024;color:#e6eef6;font-family:monospace}
.btn{display:inline-flex;gap:8px;align-items:center;padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,#ff7a7a,#ffb86b);color:#111}
.status{margin-top:10px;font-family:monospace}
</style>
</head>
<body>
<div class="container">
  <h1 style="color:var(--accent)">prometheus web obfuscator</h1>
  <label>input lua</label>
  <textarea id="input" placeholder="paste your lua code"></textarea>
  <div style="margin-top:10px;display:flex;gap:8px">
    <button id="obf" class="btn btn-primary">obfuscate</button>
    <button id="clearIn" class="btn">clear input</button>
    <button id="copyOut" class="btn" disabled>copy output</button>
  </div>

  <div class="status" id="status">ready</div>

  <label style="margin-top:12px;display:block">output</label>
  <textarea id="output" readonly placeholder="obfuscated output"></textarea>
</div>

<script>
const obf = document.getElementById('obf');
const input = document.getElementById('input');
const output = document.getElementById('output');
const status = document.getElementById('status');
const copyOut = document.getElementById('copyOut');

obf.addEventListener('click', async ()=>{
  const code = input.value;
  if (!code.trim()) { status.textContent = 'no code'; return; }
  status.textContent = 'processing...';
  obf.disabled = true;
  try {
    const r = await fetch('/api/obfuscate', {
      method:'POST',
      headers:{'content-type':'application/json'},
      body: JSON.stringify({ code })
    });
    const j = await r.json();
    if (r.ok) {
      output.value = j.output || '';
      status.textContent = 'done';
      copyOut.disabled = !output.value;
    } else {
      output.value = j.error || JSON.stringify(j);
      status.textContent = 'error';
    }
  } catch(e){
    status.textContent = 'request failed';
    output.value = e.message || String(e);
  } finally { obf.disabled = false; }
});

copyOut.addEventListener('click', async ()=>{
  try {
    await navigator.clipboard.writeText(output.value);
    status.textContent = 'copied';
  } catch {
    status.textContent = 'copy failed';
  }
});

document.getElementById('clearIn').addEventListener('click', ()=>{ input.value=''; status.textContent='ready'; });
</script>
</body>
</html>
